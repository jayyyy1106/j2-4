<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>座位表</title>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
      table-layout: fixed;
    }
    td {
      border: 1px solid black;
      text-align: center;
      vertical-align: middle;
      height: 60px;
      word-wrap: break-word;
    }
    .student {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <table id="seating">
    <tbody>
      <!-- The table here should have the same structure as your uploaded seating chart -->
      <!-- Each seat cell that should hold a student gets class="student" -->
      <!-- Example below matches your uploaded image's number of seats -->
      <tr><td></td><td></td><td class="student"></td><td class="student"></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
      <tr><td></td><td class="student"></td><td class="student"></td><td class="student"></td><td class="student"></td><td class="student"></td><td class="student"></td><td class="student"></td><td></td><td></td></tr>
      <tr><td></td><td class="student"></td><td class="student"></td><td></td><td class="student"></td><td class="student"></td><td class="student"></td><td class="student"></td><td class="student"></td><td class="student"></td></tr>
      <tr><td class="student"></td><td class="student"></td><td class="student"></td><td class="student"></td><td class="student"></td><td class="student"></td><td class="student"></td><td class="student"></td><td class="student"></td><td class="student"></td></tr>
      <tr><td class="student"></td><td class="student"></td><td class="student"></td><td class="student"></td><td class="student"></td><td class="student"></td><td></td><td class="student"></td><td class="student"></td><td class="student"></td></tr>
      <tr><td class="student"></td><td class="student"></td><td class="student"></td><td class="student"></td><td class="student"></td><td class="student"></td><td class="student"></td><td class="student"></td><td></td><td></td></tr>
    </tbody>
  </table>

  <button onclick="randomizeSeats()">随机座位</button>

  <script>
    // 学生名单
    const studentNames = {
      1: "邱穆芸", 2: "潘家宏", 3: "张芷欣", 4: "杨时瑜", 5: "颜姿彤",
      6: "许亦雪", 7: "陈嘉恩", 8: "陈钰宁", 9: "李静恩", 10: "刘瑞恩",
      11: "黄禹嫚", 12: "妮娅", 13: "陈姿齐", 14: "何汶宣", 15: "王歆茜",
      16: "潘姿颖", 17: "施凯馨", 18: "陈渝恩", 19: "戴湘霖", 20: "王靖涵",
      21: "许悦彤", 22: "朱俊纬", 23: "陈毅祥", 24: "谢承邑", 25: "张智勇",
      26: "何凯旭", 27: "赖家禾", 28: "江致承", 29: "刘俊祥", 30: "黄恩杰",
      31: "廖炫鑫", 32: "刘宽辅", 33: "卢裕城", 34: "黄康桦", 35: "伍思源",
      36: "彭宇乐", 37: "潘家扬", 38: "陈晋佑", 39: "陈有权", 40: "余根权",
      41: "黄凯杰", 42: "黄恩杰", 43: "黄俊熙", 44: "黄明杰", 45: "叶峻睿",
      46: "叶礼诚", 47: "杨仁喆"
    };

    function findAdjacentSeatPairs(seats) {
      const pairs = [];
      const seatCount = seats.length;
      const cols = 10; // number of seats per row
      for (let i = 0; i < seatCount; i++) {
        if ((i % cols) !== cols - 1) { // not last in row
          pairs.push([i, i + 1]);
        }
      }
      return pairs;
    }

    function assignPair(seats, pairIndices, pairNums) {
      for (let j = 0; j < 2; j++) {
        seats[pairIndices[j]].textContent = `${pairNums[j]} ${studentNames[pairNums[j]]}`;
      }
    }

    function saveCurrentState() {
      const data = Array.from(document.querySelectorAll('td.student')).map(td => td.textContent);
      localStorage.setItem('seating', JSON.stringify(data));
    }

    function randomizeSeats() {
      const seats = Array.from(document.querySelectorAll('td.student'));
      let numbers = Array.from({ length: 47 }, (_, i) => i + 1);
      let takenSeats = [];

      const removeFromPool = (nums) => {
        numbers = numbers.filter(n => !nums.includes(n));
      };

      const assignFixedPair = (pairNums, probability) => {
        if (Math.random() <= probability) {
          const adjacentPairs = findAdjacentSeatPairs(seats).filter(pair =>
            !takenSeats.includes(pair[0]) && !takenSeats.includes(pair[1])
          );
          if (adjacentPairs.length > 0) {
            const chosenPair = adjacentPairs[Math.floor(Math.random() * adjacentPairs.length)];
            assignPair(seats, chosenPair, pairNums);
            takenSeats.push(...chosenPair);
          }
        }
      };

      // Always pair 46 & 31
      removeFromPool([46, 31]);
      assignFixedPair([46, 31], 1);

      // 90% chance for 4 & 42
      removeFromPool([4, 42]);
      assignFixedPair([4, 42], 0.9);

      // 70% chance for 2 & 30
      removeFromPool([2, 30]);
      assignFixedPair([2, 30], 0.7);

      // Shuffle leftover numbers
      numbers.sort(() => Math.random() - 0.5);

      let idx = 0;
      for (let i = 0; i < seats.length; i++) {
        if (!takenSeats.includes(i)) {
          const num = numbers[idx++];
          seats[i].textContent = `${num} ${studentNames[num]}`;
        }
      }

      saveCurrentState();
    }
  </script>
</body>
</html>
