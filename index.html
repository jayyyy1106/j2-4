<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>初二4 座位表</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: white;
        }
        h1 {
            text-align: center;
            font-size: 20px;
            margin-bottom: 15px;
        }
        table {
            border-collapse: collapse;
            margin: 0 auto;
            border: 2px solid #000000;
        }
        td {
            width: 70px;
            height: 35px;
            border: 1px solid #d0d0d0;
            text-align: center;
            vertical-align: middle;
            font-size: 14px;
            padding: 0;
            cursor: pointer;
            background-color: white;
        }
        td.empty {
            background-color: white;
            border: 1px solid #d0d0d0;
        }
        td.teacher {
            background-color: #f2f2f2;
            font-weight: normal;
        }
        .button-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px auto;
        }
        button {
            padding: 8px 16px;
            background-color: #f2f2f2;
            color: black;
            border: 1px solid #d0d0d0;
            border-radius: 2px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background-color: #e6e6e6;
        }
    </style>
</head>
<body>
    <h1>座位表</h1>
    <div class="button-container">
        <button id="randomizeBtn">Randomize 随机分配</button>
        <button id="exportBtn">Save As PNG 保存为PNG</button>
        <button id="resetBtn">Reset 重置座位表</button>
    </div>
    <table id="seatTable"></table>

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
        // 根据提供的Excel布局初始化座位
        const seatLayout = [
            [null, null, null, null, null, null, null, null, null, null, null, null, null, null],
            [null, null, null, null, null, null, null, null, null, null, null, null, null, null],
            [null, null, null, "16", "17", null, null, null, null, null, null, null, null, null],
            [null, null, null, null, null, null, null, null, null, null, null, null, null, null],
            [null, null, null, "1", "13", null, "18", "22", null, "29", "35", null, "32", null],
            [null, null, null, null, null, null, null, null, null, null, null, null, null, null],
            [null, null, null, "5", "34", null, "14", "41", null, "6", "7", null, "38", "24"],
            [null, null, null, null, null, null, null, null, null, null, null, null, null, null],
            ["21", "15", null, "12", "37", null, "4", "8", null, "9", "19", null, "46", "31"],
            [null, null, null, null, null, null, null, null, null, null, null, null, null, null],
            ["11", "20", null, "33", "43", null, "42", "30", null, "2", "10", null, "28", "45"],
            [null, null, null, null, null, null, null, null, null, null, null, null, null, null],
            ["36", "25", null, "47", "44", null, "26", "39", null, "40", "27", null, "23", "40"],
            [null, null, null, null, null, null, "教师", "的座位", null, null, null, null, null, null]
        ];

        // 初始化表格
        function initializeTable() {
            const table = document.getElementById('seatTable');
            table.innerHTML = '';
            
            // 尝试从localStorage加载保存的数据
            const savedData = localStorage.getItem('seatTableData');
            let currentData = savedData ? JSON.parse(savedData) : null;
            
            seatLayout.forEach((row, rowIndex) => {
                const tr = document.createElement('tr');
                row.forEach((cell, colIndex) => {
                    const td = document.createElement('td');
                    if (cell === null) {
                        td.className = 'empty';
                    } else if (cell === "教师") {
                        td.className = 'teacher';
                        td.textContent = cell;
                    } else if (cell === "的座位") {
                        td.className = 'teacher';
                        td.textContent = cell;
                    } else {
                        // 如果有保存的数据，使用保存的值，否则使用初始值
                        const savedValue = currentData ? currentData[rowIndex][colIndex] : cell;
                        td.textContent = savedValue;
                        td.addEventListener('click', function() {
                            const newNum = prompt("输入新号码 (1-47):", this.textContent);
                            if (newNum !== null && newNum !== "" && !isNaN(newNum)) {
                                this.textContent = newNum;
                                saveCurrentState(); // 保存修改
                            }
                        });
                    }
                    tr.appendChild(td);
                });
                table.appendChild(tr);
            });
        }

        // 保存当前状态到localStorage
        function saveCurrentState() {
            const table = document.getElementById('seatTable');
            const rows = table.querySelectorAll('tr');
            const currentData = [];
            
            rows.forEach(row => {
                const rowData = [];
                const cells = row.querySelectorAll('td');
                cells.forEach(cell => {
                    if (cell.classList.contains('teacher')) {
                        rowData.push("教师的座位");
                    } else if (cell.classList.contains('empty')) {
                        rowData.push(null);
                    } else {
                        rowData.push(cell.textContent);
                    }
                });
                currentData.push(rowData);
            });
            
            localStorage.setItem('seatTableData', JSON.stringify(currentData));
        }

        // 随机分配座位
        function randomizeSeats() {
            const seats = Array.from(document.querySelectorAll('td:not(.empty):not(.teacher)'));
            let numbers = Array.from({length: 47}, (_, i) => i + 1);
            numbers = numbers.sort(() => Math.random() - 0.5);
            
            seats.forEach((seat, index) => {
                seat.textContent = numbers[index];
            });
            
            saveCurrentState(); // 保存随机分配结果
        }

        // 重置座位表
        function resetTable() {
            if (confirm('确定要重置座位表吗？所有更改将丢失。')) {
                localStorage.removeItem('seatTableData');
                initializeTable();
            }
        }

        // 导出为PNG
        function exportToPNG() {
            const table = document.getElementById('seatTable');
            
            html2canvas(table, {
                backgroundColor: '#FFFFFF',
                scale: 2
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = '座位表.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }

        // 初始化页面
        initializeTable();
        document.getElementById('randomizeBtn').addEventListener('click', randomizeSeats);
        document.getElementById('exportBtn').addEventListener('click', exportToPNG);
        document.getElementById('resetBtn').addEventListener('click', resetTable);
    </script>
</body>
</html>
